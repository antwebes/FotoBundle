{% extends '::layout.html.twig' %}

{% block body_container_center %}
<div class="container-fluid">
	<div class="span10">
		<img src="{{ vich_uploader_asset(foto, 'image') }}" class="fotoalbum" />
	</div>
	<div class="span2">
			Aquí van comentario y demás historias.
		<p>Etiqueta a tus amigos</p>
		<input type="text" value="amigo" id="etiquetar">
		<a class="edit" data-id="{{ foto.id }}">Etiquetar</a>		
	</div>
</div>
<hr>
{% endblock %}

{% block body_container_right %}
	{{ parent() }}	
{% endblock %}
{% block body_js_final %}
	{% javascripts	'@AntFotoBundle/Resources/public/js/vendor/jquery-ui-1.9.1.custom.min.js' %}
		<script src="{{ asset_url }}"></script>
		{{ parent() }}   
	{% endjavascripts %}
	
	<script>
	  <!-- Script para autocompletar -->
	  $(document).ready(function(){
		  $.urlParam = function(name){
		  var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
		  if(results != null)
		  	return results[1] || 0;
		  else {
			  $.getJSON( "{{path('amigos') }}",
				        function(data){
				    	var amigos = [];
				    	$.each(data.amigos, function(i,item){
					    	 amigos.push(item.username);    	
				            	});	
				    	$( "#etiquetar" ).autocomplete({
			                source: amigos    	
				    		});
				          });
			  }
		  }

		  var user = $.urlParam('user') || null;
		  if(user != null) {
		  $('#message_recipient').val(user);
		  $('#recipientContainer').hide();
		  $('#recipientUser').html('Mensaje para ' +user);
		  }
		  });	
	  </script>
	  <script>
		$(document).ready(function(){
			$(".edit").click(function(){
				var id =$(this).data("id");
				var userId =$("#etiquetar").val();
				
				var foto_url = "{{ app.request.uriForPath('/foto/label/')}}" + id + '/' + userId;
				console.log(foto_url);
				var foto = $("#foto"+id);	
	            		$.ajax({
	          				  type: "PUT",
	          				  url: foto_url
	          				  //data: {foto: {titulo: result}}
	          				}).done(function( msg ) {
		          				console.log(msg);
	          					//$("#ftit"+id).html(msg.foto.titulo);
	          					//$("#pin"+id).remove();
	          				});

				});			
		});
		</script>	
{% endblock %}